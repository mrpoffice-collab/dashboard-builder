generator client {
  provider      = "prisma-client"
  output        = "../app/generated/prisma"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_UNPOOLED")
}

model User {
  id            String       @id @default(cuid())
  email         String       @unique
  passwordHash  String
  dashboards    Dashboard[]
  dataSources   DataSource[]
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
}

model Dashboard {
  id          String    @id @default(cuid())
  name        String
  description String?
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  widgets     Widget[]
  shareToken  String?   @unique
  isPublic    Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Widget {
  id           String    @id @default(cuid())
  dashboardId  String
  dashboard    Dashboard @relation(fields: [dashboardId], references: [id], onDelete: Cascade)
  type         String
  title        String
  config       Json      @default("{}")
  dataConfig   Json      @default("{}")
  position     Json      @default("{\"x\":0,\"y\":0,\"w\":2,\"h\":2}")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model DataSource {
  id           String    @id @default(cuid())
  userId       String
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  name         String
  type         String
  credentials  Json?
  config       Json      @default("{}")
  data         Json      @default("[]")
  columns      Json      @default("[]")
  lastSync     DateTime?
  syncStatus   String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}
